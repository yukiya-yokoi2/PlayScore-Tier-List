<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>PlayScore Tier List</title>
        <link rel="stylesheet" href="style.css">
    </head>
    
    <body>
        <!-- ヘッダー-->
        <div class="header">
            <div class ="header-logo">
                <img src="images/PlayScore Tier List_Logo.png" alt="PlayScore Tier List" class="logo-image">
            </div>
            <div class="header-list">
                <ul>
                <li><a href="index.html">総合</a></li>
                <li><a href="index.html#year">プレイ年ごと</a></li>
                <li><a href="create.html">ランキング作成</a></li>
                </ul>
            </div>
        </div>

        <!-- メイン-->
        <div class="main">
            <div class="copy-container">
                <h1>
                    PlayScore Tier List<span>.</span>
                </h1>
            </div>

            <div class="contents">
                
                <!--ボタン-->
                <div class="button-area">
                    <button id="add-item-btn">アイテム追加</button>
                    <button id="save-table-btn">表の保存</button>
                </div>

                <!--↓↓↓ランキングテーブル↓↓↓-->
                <div class ="ranking-table">
                    <div class ="rank-row">
                        <div class="rank-label">10点</div>
                        <div class="rank-games">
                            <!--ここに画像ゲームを追加-->

                        </div>
                    </div>
                    <div class ="rank-row">
                        <div class="rank-label">9点</div>
                        <div class="rank-games">
                            <!--ここに画像ゲームを追加-->

                        </div>
                    </div>
                    <div class ="rank-row">
                        <div class="rank-label">8点</div>
                        <div class="rank-games">
                            <!--ここに画像ゲームを追加-->

                        </div>
                    </div>
                    <div class ="rank-row">
                        <div class="rank-label">7点</div>
                        <div class="rank-games">
                            <!--ここに画像ゲームを追加-->

                        </div>
                    </div>
                    <div class ="rank-row">
                        <div class="rank-label">6点</div>
                        <div class="rank-games">
                            <!--ここに画像ゲームを追加-->

                        </div>
                    </div>
                    <div class ="rank-row">
                        <div class="rank-label">5点</div>
                        <div class="rank-games">
                            <!--ここに画像ゲームを追加-->

                        </div>
                    </div>
                    <div class ="rank-row">
                        <div class="rank-label">4点</div>
                        <div class="rank-games">
                            <!--ここに画像ゲームを追加-->

                        </div>
                    </div>
                    <div class ="rank-row">
                        <div class="rank-label">3点</div>
                        <div class="rank-games">
                            <!--ここに画像ゲームを追加-->

                        </div>
                    </div>
                    <div class ="rank-row">
                        <div class="rank-label">2点</div>
                        <div class="rank-games">
                            <!--ここに画像ゲームを追加-->

                        </div>
                    </div>
                    <div class ="rank-row">
                        <div class="rank-label">1点</div>
                        <div class="rank-games">
                            <!--ここに画像ゲームを追加-->

                        </div>
                    </div>

                </div>
                <!--↑↑↑ランキングテーブル↑↑↑-->
                <div id="delete-area">
                    ここにドラッグして削除
                </div>

            </div>

            <div class ="contact-form">

            </div>
        </div>
        
        <!-- フッター-->
        <div class="footer">
            <div class ="footer-logo">
                <img src="images/PlayScore Tier List_Logo.png" alt="PlayScore Tier List" class="logo-image-footer">
            </div>
            <div class="footer-list">
                <ul>
                <li>ランキングの基準</li>
                <li>プライバシーポリシー</li>
                <li>免責事項</li>
                <li>お問い合わせ</li>
                </ul>
            </div>
        </div>

    <!--画像選択機能-->
    <script>
    // ボタンを取得
    const addBtn = document.getElementById("add-item-btn");

    // ボタンが押されたら実行
    addBtn.addEventListener("click", () => {
        // 画像ファイル選択ダイアログを作成
        const input = document.createElement("input");
        input.type = "file";
        input.accept = "image/*";

        // 画像が選ばれたら
        input.onchange = () => {
            const file = input.files[0];
            if (!file) return;

            // 点数を選択（1〜10）
            const score = prompt("点数を入力してください（1〜10）");
            const num = Number(score);

            if (num < 1 || num > 10 || isNaN(num)) {
                alert("1〜10の数字を入力してください");
                return;
            }

            // 対応する rank-games を取得
            const rows = document.querySelectorAll(".rank-row");
            const targetRow = rows[10 - num]; // 10点が1番目なので逆順

            const gamesDiv = targetRow.querySelector(".rank-games");

            // 画像を追加
            const img = document.createElement("img");
            img.src = URL.createObjectURL(file);
            img.classList.add("added-image");

            // ★ ドラッグ可能にする
            img.draggable = true;

            // ★ ドラッグ開始イベント
            img.addEventListener("dragstart", (e) => {
                e.dataTransfer.setData("text/plain", img.src);
                window.draggedImage = img; // 今ドラッグしている画像を保存
            });

            gamesDiv.appendChild(img);
        };

        // ダイアログを開く
        input.click();
    });

    // すべての rank-row にドロップを許可
    document.querySelectorAll(".rank-row").forEach(row => {

        // ドラッグされた要素が上に来た時
        row.addEventListener("dragover", (e) => {
            e.preventDefault(); // これがないとドロップできない
        });

        // ドロップされた時
        row.addEventListener("drop", (e) => {
            e.preventDefault();

            const targetGames = row.querySelector(".rank-games");

            // ★ ドラッグ中の画像を移動
            if (window.draggedImage) {
                targetGames.appendChild(window.draggedImage);
                window.draggedImage = null;
            }
        });
    });

    // ★ 削除エリアを取得
    const deleteArea = document.getElementById("delete-area");

    // ドラッグ中の画像が上に来た時
    deleteArea.addEventListener("dragover", (e) => {
        e.preventDefault();
        deleteArea.style.backgroundColor = "#ffe5e5"; // ハイライト
    });

    // ドラッグが離れた時（削除）
    deleteArea.addEventListener("drop", (e) => {
        e.preventDefault();
        deleteArea.style.backgroundColor = "transparent";

        if (window.draggedImage) {
            window.draggedImage.remove(); // ★ 画像を削除
            window.draggedImage = null;
        }
    });

    // ドラッグが離れたらハイライト解除
    deleteArea.addEventListener("dragleave", () => {
        deleteArea.style.backgroundColor = "transparent";
    });
    
    // ★ 表の保存ボタン
    const saveBtn = document.getElementById("save-table-btn");

    saveBtn.addEventListener("click", () => {
        const table = document.querySelector(".ranking-table");

        html2canvas(table).then(canvas => {
            const link = document.createElement("a");
            link.href = canvas.toDataURL("image/png");
            link.download = "tier-list.png"; // 保存されるファイル名
            link.click();
        });
    });

    </script>

    <!--ライブラリ（html2canvas）を読み込む-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>      
    </body>
</html>